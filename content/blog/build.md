+++
title = "Create Project commands"
date = "2024-02-29T17:15:29-05:00"

#
# description is optional
#
# description = "An optional description for SEO. If not provided, an automatically created summary will be used."

tags = []
+++

In `package.json`, add to `scripts` section:

```json
		"brew": "coffee -cmb --no-header .",
```

That will find every `*.coffee` file and create a corresponding
`*.js` file in the same directory. The `-c` option specifies that
found `*.coffee` files should be compiled to `*.js` files.
The `-m` option also causes output of a `*.map`, or source map
file. The `-b` option disables the function wrapper around all
of the code in the `*.js` file that's added by default.
Also, the `--no-header` option causes CoffeeScript to not
output the commend `// Generated by CoffeeScript 2.7.0`.
That's important here because that will precede the "shebang" line, so
it would not be recognized. All `*.coffee` files in the directories
`src/lib` and `src/bin` will be compiled.

Now, say you want to create a command named `peggify` that will
search for `*.peggy` files and compile them to `*.js` files.
Create the file `src/bin/peggify.coffee`:

```coffee
`#!/usr/bin/env node
`
# peggify.coffee

import {LOG, execCmd} from '@jdeighan/base-utils'
import {allFilesIn, withExt} from '@jdeighan/base-utils/fs'

# ---------------------------------------------------------------------------

LOG "peggifying..."
for hFile from allFilesIn('./**/*.peggy')
	{fileName, filePath} = hFile
	newName = withExt(fileName, '.js')
	LOG "#{filePath} => #{newName}"
	# execCmd "npx peggy -m --format es --allowed-start-rules * #{filePath}"
```

NOTE:

1. The file must start with a "shebang" line. This illustrates
	how to do that in CoffeeScript.
2. This script will not actually execute the `peggy` command
	since the relevant line is commented out. That's so we can
	test things out before actually modifying anything.

Next, add this entry under the "bin" key in your `package.json`:

```json
		"peggify": "./src/bin/peggify.js",
```
Note that we're executing the `*.js` file, not the `*.coffee` file
so we'll need to run the **brew** script before attempting to
run the **peggify** binary. In your bash shell, you can now execute:

```bash
$ npm run brew
$ npx peggify
```

If you don't want the extraneous output from `npm run`, create this
file in your project root:

```text
engine-strict=true
loglevel=silent
```
You can, of course, add a `peggify` script to the **scripts** section
in `package.json` to do all of this in one command:

```json
		"build": "npm run brew && npx peggify",
```
Then, in your bash shell, just run:
```bash
$ npm run build
```
